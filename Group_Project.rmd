---
title: "Group Project"
author: "Wan Ting Hsu"
date: "2/22/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
rm(list = ls())
```

# Load packages
```{r}
library(dplyr)
library(tidyverse)
library(lubridate)
library(readr)
library(hrbrthemes)
library(bsts)
library(ggplot2)
library(patchwork)
```

#Read data (zikang edits)
```{r}

nypd <- read.csv("nypd.csv")
nypd <- nypd %>% mutate(CMPLNT_FR_DT = mdy(CMPLNT_FR_DT ))
nypd$CMPLNT_FR_DT<-as.Date(nypd$CMPLNT_FR_DT)  


new<- nypd %>% 
  filter(CMPLNT_FR_DT >= "2010-03-01") %>%
  dplyr::select(CMPLNT_FR_DT, VIC_RACE) %>%
  group_by(CMPLNT_FR_DT, VIC_RACE) %>%
  count(VIC_RACE)

new$CMPLNT_FR_DT <- format(as.Date(new$CMPLNT_FR_DT), "%Y-%m")
colnames(new)[1] = "date"
colnames(new)[2] = "race"
str_trim(new$race, side = "both")

new <- new[-which(new$race == ""), ]



```

#before & after covid

```{r}
#bc = 10 years period before covid 
bc <- new %>%
  filter(date <"2020-03") %>%
  group_by(date) %>%
  count(race)

#ac = after covid from 2020-03 to 2021-12-31
ac <- new %>%
  filter(date >= "2020-03") %>%
  group_by(date) %>%
  count(race)
```

#pivot_wider
```{r}
ac <- ac %>% pivot_wider(names_from = race, values_from = n)
bc <- bc %>% pivot_wider(names_from = race, values_from = n)

ac[is.na(ac)] = 0
bc[is.na(bc)] = 0
```

#create asian/non-asian
```{r}
ac$non_asian <- rowSums(ac[,c("BLACK", "BLACK HISPANIC", "UNKNOWN", "WHITE", "WHITE HISPANIC", "AMERICAN INDIAN/ALASKAN NATIVE")])
bc$non_asian <- rowSums(bc[,c("BLACK", "BLACK HISPANIC", "UNKNOWN", "WHITE", "WHITE HISPANIC", "AMERICAN INDIAN/ALASKAN NATIVE")])
```

```{r}
ac <- ac %>% dplyr::select(date, `ASIAN / PACIFIC ISLANDER`, non_asian)
bc <- bc %>% dplyr::select(date, `ASIAN / PACIFIC ISLANDER`, non_asian)
```


#before covid correlation
```{r}
cor(bc$`ASIAN / PACIFIC ISLANDER`, bc$non_asian)

```









